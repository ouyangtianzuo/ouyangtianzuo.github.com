<html><head>
<title>拼图游戏</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=640,initial-scale=0.9,maximum-scale=0.9,user-scalable=yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<style type="text/css">
    a{
        color:#FF0000;
        text-decoration:none;
    }
    a:hover{
        text-decoration:underline;
    }
    body{
        background-repeat:no-repeat;
        font-family: Trebuchet MS, Lucida Sans Unicode, Arial, sans-serif;
        width:300px;
        margin:auto;
		padding:auto;  
        text-align:left;
		overflow:hidden;
		font-family:"黑体";
    }
    #puzzle_container{
        line-height:300px;
        text-align:center;
        vertical-align:center;
        border:5px solid #CCCCCC;
        position:relative;
        color: #FFFFFF;
        background-color: #707070;
        width: 300px;	/* IE 5.x */
        width/* */:/**/300px;
        width: /**/300px;

        height: 300px;
        height/* */:/**/300px;
        height: /**/300px;
		margin: auto auto;
    }
    #puzzle_container .square{
        overflow:hidden;
        border-left:1px solid #FFF;
        border-top:1px solid #FFF;
        position:absolute;
    }
    .activeImageIndicator{
        border:1px solid #FF0000;
        position:absolute;
        z-index:10000;
    }
    .revealedImage{
        position:absolute;
        left:0px;
        opacity:0;
        filter:alpha(opacity=50);
        top:0px;
        z-index:50000;
    }
	#messageDiv{
		width:300px; margin:auto auto; text-align; margin-top:10px;
	}
	#messageDiv div{
		display:inline; font-size:18px; font-weight:300; font-family:"黑体";
	}
	#messageDiv #time{float:left; }
	#messageDiv #stepNum{float:right;}
	.red{color:red;}
	.gameBtn, .gameParameter{width:300px; margin:auto auto; text-align:center; margin-top:10px; margin-bottom:10px;}
	.gameParameter input{text-align:center;}
	
	.startGame, .changeImg{display:inline-block; color:#fff; text-align:center; width:80px; height:30px; line-height:30px; background: #ed5c3d; border-bottom:2px solid #e04213; text-decoration:none;}
</style>
<script type="text/javascript">
var puzzleImages = ['images/001.jpg','images/001.jpg'];
var rows = 3;
var cols = 3;
var imageArray = new Array();
var imageInUse = false;
var puzzleContainer;
var activeImageIndicator = false;
var activeSquare = false;
var squareArray = new Array();
var emptySquare_x;
var emptySquare_y;
var colWidth;
var rowHeight;
var gameInProgress = false;
var revealedImage = false;
var stardate=true; //用于判断开始游戏时候的计时，重新打乱图片不会重新计时
var sit=null; //定时器
var stepNumber=0; //完成步数
var stepNumDiv=null;
var dataDiv=null;

for(var no=0;no<puzzleImages.length;no++){
    imageArray[no] = new Image();
    imageArray[no].src = puzzleImages[no];
}
function initPuzzle()
{
    stepNumDiv=document.getElementById('stepNum');
	dataDiv=document.getElementById('time');
	stepNumber=0;
	stepNumDiv.innerHTML="游戏步数：<span class='red'>"+stepNumber+"</span>";
	dataDiv.innerHTML="游戏时间：<span class='red'>00:00</span>";
	stardate=true;
	clearInterval(sit);
	
	gameInProgress = false;
    var tmpInUse = imageInUse;
    imageInUse = imageArray[Math.floor(Math.random() * puzzleImages.length)];
    if(imageInUse==tmpInUse && puzzleImages.length>1)
        initPuzzle();
    else{
        puzzleContainer = document.getElementById('puzzle_container');
        getImageWidth();
    }
}
function getImageWidth()
{
    if(imageInUse.width>0){
        startPuzzle();
    }else{
        setTimeout('getImageWidth()',100);
    }
}
//打乱图片
function scramble()
{
    
	gameInProgress = true;
    var currentRow = cols-1;
    var currentCol = rows-1;
    document.getElementById('revealedImage').style.display='none';
    for(var no=0;no<rows;no++){
        for(var no2=0;no2<cols;no2++){
            if(no<rows.length || no2<cols.length){
                var el = document.getElementById('square_' + no2 + '_' + no);
                if(el){
                    el.style.left = (no2 * colWidth) + (no2) + 'px';
                    el.style.top = (no * rowHeight) + (no) + 'px';
                }else{
                    initPuzzle();
                    return;
                }
            }
        }
    }
    var lastPos=false;
    var countMoves = 0;
    while(countMoves<(50*cols*rows)){
        var dir = Math.floor(Math.random()*4);
        var readyToMove = false;
        if(dir==0 && currentRow>0 && lastPos!=1){
            currentRow = currentRow-1;
            readyToMove = true;
        }
        if(dir==1 && currentRow<(rows-1) && lastPos!=0){
            currentRow = currentRow+1;
            readyToMove = true;
        }
        if(dir==2 && currentCol>0 && lastPos!=3){
            currentCol = currentCol -1;
            readyToMove = true;
        }
        if(dir==3 && currentCol<(cols-1) && lastPos!=2){
            currentCol = currentCol + 1;
            readyToMove = true;
        }
        if(readyToMove){
            activeSquare = document.getElementById('square_' + currentCol + '_' + currentRow);
            moveImage(false,true);
            lastPos = dir;
            countMoves++;
        }
    }
	
	timeKeeping();
	
    return;
}
function gameFinished()
{
    var string = "";
    var squareWidth = colWidth + 1;
    var squareHeight = rowHeight + 1;
    var squareCounter = 0;
    var errorsFound = false;
    var correctSquares = 0;
    for(var prop in squareArray){
        var currentCol = squareCounter % cols;
        var currentRow = Math.floor(squareCounter/cols);
        var correctLeft = currentCol * squareWidth;
        var correctTop = currentRow * squareHeight;
        if(squareArray[prop].style.left.replace('px','') != correctLeft || squareArray[prop].style.top.replace('px','') != correctTop){
            //return;
        }else{
            correctSquares++;
        }
        squareCounter++;
    }
    if(correctSquares == ((cols * rows) -1)){
		clearInterval(sit);
		var timeP=document.getElementById('time');
		var ftime=timeP.getElementsByTagName('span')[0].innerHTML;
		//alert(ftime);
		//alert(stepNumber);
        document.getElementById('messageDiv').innerHTML = '<h2 style="text-align:center">完成游戏！'+'游戏用时<span class="red">'+ftime+'</span>! 游戏步数<span class="red">'+stepNumber+'</span>!</h2>';
        gameInProgress = false;
        revealImage();
    }else{
        //document.getElementById('messageDiv').innerHTML = '当前, 你有 ' + correctSquares + ' 块 ' + ' 位置正确';
    }
	
}
var currentOpacity = 0;
function revealImage()
{
    if(currentOpacity==100)currentOpacity=0;
    var obj = document.getElementById('revealedImage');
    obj.style.display = 'block';
    currentOpacity = currentOpacity +2;
    if(document.all){
        obj.style.filter = 'alpha(opacity='+currentOpacity+')';
    }else{
        obj.style.opacity = currentOpacity/100;
    }
    if(currentOpacity<100)setTimeout('revealImage()',10);
}
function displayActiveImage()
{
    if(!gameInProgress)return;
    if(!activeImageIndicator){
        activeImageIndicator = document.createElement('DIV');
        activeImageIndicator.className = 'activeImageIndicator';
        puzzleContainer.appendChild(activeImageIndicator);
        activeImageIndicator.onclick = moveImage;
    }
    activeImageIndicator.style.display='block';
    activeImageIndicator.style.left = this.offsetLeft + 'px';
    activeImageIndicator.style.top = this.offsetTop + 'px';
    activeImageIndicator.style.width = this.style.width;
    activeImageIndicator.style.height = this.style.height;
    activeImageIndicator.innerHTML = '<span></span>';
    activeSquare = this;
}
//打乱图片时候的移动，e: false   fromShuffleFunction: true， 
//游戏中的移动，e: MouseEvent    fromShuffleFunction: undifened
function moveImage(e,fromShuffleFunction)
{
    
    if(!activeSquare)return;
    if(!gameInProgress && !fromShuffleFunction){
        alert('你得先打乱图片顺序');
        return;
    }
	
    var currentLeft = activeSquare.style.left.replace('px','') /1;
    var currentTop = activeSquare.style.top.replace('px','') /1;
    var diffLeft = Math.round((currentLeft - emptySquare_x) / colWidth);
    var diffTop = Math.round((currentTop - emptySquare_y) / rowHeight);
    if(((diffLeft==-1 || diffLeft==1) && diffTop==0) || ((diffTop==-1 || diffTop==1) && diffLeft==0)){
		
		if(e&&!fromShuffleFunction){
			stepNumber++;			//alert(stepNumber);
			stepNumDiv.innerHTML="游戏步数：<span class='red'>"+stepNumber+"<span>";
		}
		
        activeSquare.style.left = emptySquare_x + 'px';
        activeSquare.style.top = emptySquare_y + 'px';
        emptySquare_x = currentLeft;
        emptySquare_y = currentTop;
        activeSquare = false;
        if(activeImageIndicator)activeImageIndicator.style.display = 'none';
        if(!fromShuffleFunction)gameFinished();
    }
}
function startPuzzle()
{
    puzzleContainer.innerHTML = '';
    var subDivs = puzzleContainer.getElementsByTagName('DIV');
    for(var no=0;no<subDivs.length;no++){
        subDivs[no].parentNode.removeChild(subDivs[no]);
    }
    activeImageIndicator = false;
    squareArray.length = 0;
    if(document.getElementById('revealedImage')){
        var obj = document.getElementById('revealedImage');
        obj.parentNode.removeChild(obj);
    }
    var revealedImage = document.createElement('DIV');
    revealedImage.style.display='none';
    revealedImage.id='revealedImage';;
    revealedImage.className='revealedImage';;
    var img = document.createElement('IMG');
    img.src = imageInUse.src;
    revealedImage.appendChild(img);
    puzzleContainer.appendChild(revealedImage);
    colWidth = Math.round(imageInUse.width / cols)-1;
    rowHeight = Math.round(imageInUse.height / rows)-1;
    puzzleContainer.style.width = colWidth * cols + (cols * 1) + 'px';
    puzzleContainer.style.height = rowHeight * rows + (rows * 1) + 'px';
    if(navigator.appVersion.indexOf('5.')>=0 && navigator.userAgent.indexOf('MSIE')>=0){
        puzzleContainer.style.width = colWidth * cols + (cols * 1) + 20 + 'px';
        puzzleContainer.style.height = rowHeight * rows + (rows * 1) + 20 + 'px';
    }
    if(!revealedImage){
        revealedImage = document.createElement('DIV');
        revealedImage.style.display='none';
        revealedImage.innerHTML = '';
    }
    for(var no=0;no<rows;no++){
        for(var no2=0;no2<cols;no2++){
            if(no2==cols-1 && no==rows-1){
                emptySquare_x = (no2 * colWidth) + (no2);
                emptySquare_y = (no * rowHeight) + (no);
                break;
            }
            var newDiv = document.createElement('DIV');
            newDiv.id = 'square_' + no2 + '_' + no;
            newDiv.onmouseover = displayActiveImage;
            newDiv.onclick = moveImage;
            newDiv.className = 'square';
            newDiv.style.width = colWidth + 'px';
            newDiv.style.height = rowHeight + 'px';
            newDiv.style.left = (no2 * colWidth) + (no2) + 'px';
            newDiv.style.top = (no * rowHeight) + (no) + 'px';
            newDiv.setAttribute('initPosition',(no2 * colWidth) + (no2) + '_' + (no * rowHeight) + (no));
            var img = new Image();
            img.src = imageInUse.src;
            img.style.position = 'absolute';
            img.style.left = 0 - (no2 * colWidth) + 'px';
            img.style.top = 0 - (no * rowHeight) + 'px';
            newDiv.appendChild(img);
            puzzleContainer.appendChild(newDiv);
            squareArray.push(newDiv);
        }
    }
}

function timeKeeping(){
	if(stardate){
		stardate=false;
		var i=0;
		sit=setInterval(function(){
			i++;
			var second=i%60;
			var minute=Math.floor(i/60);
			dataDiv.innerHTML="游戏时间：<span class='red'>"+numFormat(minute)+":"+numFormat(second)+"</span>";
		},1000);
	}
}
function numFormat(num){
	if(num<10){
		return 0+''+num;
	}
	return num;
}

window.onload = initPuzzle;
</script>
</head>
<body ryt13666="1">

<div class="gameBtn"><a href="#" class="startGame" onclick="scramble();return false">开始游戏</a> | <a href="#" class="changeImg" onclick="initPuzzle();return false">重新开始</a></div>
<!--<form class="gameParameter">
    行数/列数: <input type="text" value="3" onblur="var no = this.value.replace(/[^\d]/g,'');if(no/1<3){ this.value = '3';no=3; };cols=no" maxlength="1" size="2"> *
    <input type="text" value="3" onblur="var no = this.value.replace(/[^\d]/g,'');if(no/1<2){ this.value = '2';no=2; };rows=no" maxlength="1" size="2">
</form>-->
<div id="puzzle_container" style="width: 300px; height: 219px;"><div id="revealedImage" class="revealedImage" style="display: block; opacity: 1;"><img src="http://win-worlds.com/pintu/images/001.jpg"></div><div id="square_0_0" class="square" initposition="0_00" style="width: 99px; height: 72px; left: 0px; top: 0px;"><img src="http://win-worlds.com/pintu/images/001.jpg" style="position: absolute; left: 0px; top: 0px;"></div><div id="square_1_0" class="square" initposition="100_00" style="width: 99px; height: 72px; left: 100px; top: 0px;"><img src="http://win-worlds.com/pintu/images/001.jpg" style="position: absolute; left: -99px; top: 0px;"></div><div id="square_2_0" class="square" initposition="200_00" style="width: 99px; height: 72px; left: 200px; top: 0px;"><img src="http://win-worlds.com/pintu/images/001.jpg" style="position: absolute; left: -198px; top: 0px;"></div><div id="square_0_1" class="square" initposition="0_721" style="width: 99px; height: 72px; left: 0px; top: 73px;"><img src="http://win-worlds.com/pintu/images/001.jpg" style="position: absolute; left: 0px; top: -72px;"></div><div id="square_1_1" class="square" initposition="100_721" style="width: 99px; height: 72px; left: 100px; top: 73px;"><img src="http://win-worlds.com/pintu/images/001.jpg" style="position: absolute; left: -99px; top: -72px;"></div><div id="square_2_1" class="square" initposition="200_721" style="width: 99px; height: 72px; left: 200px; top: 73px;"><img src="http://win-worlds.com/pintu/images/001.jpg" style="position: absolute; left: -198px; top: -72px;"></div><div id="square_0_2" class="square" initposition="0_1442" style="width: 99px; height: 72px; left: 0px; top: 146px;"><img src="http://win-worlds.com/pintu/images/001.jpg" style="position: absolute; left: 0px; top: -144px;"></div><div id="square_1_2" class="square" initposition="100_1442" style="width: 99px; height: 72px; left: 100px; top: 146px;"><img src="http://win-worlds.com/pintu/images/001.jpg" style="position: absolute; left: -99px; top: -144px;"></div><div class="activeImageIndicator" style="display: none; left: 200px; top: 146px; width: 99px; height: 72px;"><span></span></div></div>
<div id="messageDiv"><h2 style="text-align:center">完成游戏！游戏用时<span class="red">00:04</span>! 游戏步数<span class="red">08</span>!</h2></div>
<div style="clear:both;">
    <script type="text/javascript">
        //var gaJsHost = (("https:" == document.location.protocol) ? "https://www.baidu.com" : "http://www.mb5u.com");
        //document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
        try {
            var pageTracker = _gat._getTracker("UA-1334907-4");
            pageTracker._trackPageview();
        }
        catch(err) {}
    </script>
</div>
<br>
<div style="margin:auto auto; width:300px; color:#666;">打开后请等待加载，因背景图较大，需要一定时间加载，你可以刷新页面试一下。</div>

</body></html>